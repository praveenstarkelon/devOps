// Replace any previous '#sidebar a' click handler with this
document.querySelectorAll('#sidebar a').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();
    const target = document.querySelector(this.getAttribute('href'));
    if (!target) return;

    // --- detect any fixed top element (header/nav) and use its height as offset ---
    const fixedTop = Array.from(document.querySelectorAll('body *')).find(el => {
      const cs = getComputedStyle(el);
      // position fixed and attached to very top
      return cs.position === 'fixed' && Math.round(el.getBoundingClientRect().top) === 0 && el.offsetWidth >= window.innerWidth * 0.5;
    });
    const headerOffset = fixedTop ? fixedTop.offsetHeight : 20; // fallback offset if none found

    // compute final scroll position so that the section appears just below the header
    const targetY = target.getBoundingClientRect().top + window.pageYOffset - headerOffset - 8; // -8 for small breathing space

    // smooth scroll
    window.scrollTo({ top: targetY, behavior: 'smooth' });

    // accessibility: focus the section without jumping
    target.setAttribute('tabindex', '-1'); // ensure focusable
    target.focus({ preventScroll: true });
  });
});
